/*! tk-audials 2016-01-02 */
"use strict";function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),TkAudial=function(){function a(b,c){if(_classCallCheck(this,a),!(this instanceof a))return new a(b,c);if(this.element=b,this.touchCount=0,this.parseOptions(c),this.display=this.create("svg","display"),this.options.inputId&&(this.inputField=this.create("input","",this.options.inputId)),this.border=this.create("circle","border"),this.indicatorBackground=this.create("circle","indicator-background"),this.indicator=this.create("path","indicator"),this.valueBackground=this.create("circle","value-background"),this.valueText=this.create("text","value-text"),this.display.setAttributeNode(this.attribute("viewBox","0 0 230 230")),this.border.setAttributeNode(this.attribute("cx",115)),this.border.setAttributeNode(this.attribute("cy",115)),this.border.setAttributeNode(this.attribute("r",115)),this.border.setAttributeNode(this.attribute("fill",this.options.borderColour)),this.border.setAttributeNode(this.attribute("stroke-width",0)),this.indicatorBackground.setAttributeNode(this.attribute("cx",115)),this.indicatorBackground.setAttributeNode(this.attribute("cy",115)),this.indicatorBackground.setAttributeNode(this.attribute("r",this.roundPlaces(115-this.options.borderWidth,2))),this.indicatorBackground.setAttributeNode(this.attribute("fill",this.options.indicatorBackgroundColour)),this.indicatorBackground.setAttributeNode(this.attribute("stroke-width",0)),this.indicator.setAttributeNode(this.attribute("fill",this.options.indicatorColour)),this.indicator.setAttributeNode(this.attribute("stroke",this.options.indicatorColour)),this.indicator.setAttributeNode(this.attribute("stroke-width",0)),this.valueBackground.setAttributeNode(this.attribute("cx",115)),this.valueBackground.setAttributeNode(this.attribute("cy",115)),this.valueBackground.setAttributeNode(this.attribute("r",this.roundPlaces(115-this.options.borderWidth-this.options.indicatorWidth,2))),this.valueBackground.setAttributeNode(this.attribute("fill",this.options.valueBackgroundColour)),this.valueText.setAttributeNode(this.attribute("x","50%")),this.valueText.setAttributeNode(this.attribute("y","50%")),this.valueText.setAttributeNode(this.attribute("dy",".33em")),this.valueText.setAttributeNode(this.attribute("fill",this.options.valueColour)),this.valueText.setAttributeNode(this.attribute("font-size",this.options.valueFontSize)),this.valueText.textContent=this.round(this.value,this.options.step),this.inputField&&this.display.appendChild(this.inputField),this.options.enableClipboard){var d=!1,e=Array.from(document.querySelectorAll("script"));d=!e.every(function(a,b,c){return-1==a.src.indexOf("clipboard.min.js")}),d||(this.clipboardScript=document.createElement("script"),this.clipboardScript.setAttribute("type","text/javascript"),this.clipboardScript.setAttribute("src","build/clipboard.min.js"),this.clipboardScript.setAttribute("id","clipboard-script"),document.getElementsByTagName("head")[0].appendChild(this.clipboardScript)),this.clipboarder=this.create("button","clipboarder"),this.clipboarder.setAttributeNode(this.attribute("data-clipboard-text","")),this.element.appendChild(this.clipboarder)}this.options.borderWidth>0&&this.display.appendChild(this.border),this.display.appendChild(this.indicatorBackground),this.display.appendChild(this.indicator),this.display.appendChild(this.valueBackground),this.display.appendChild(this.valueText),b.appendChild(this.display),null!==this.element&&this.init()}return _createClass(a,[{key:"init",value:function(){self.addEventListener("touchstart",this.touchHandler.bind(this),!0),self.addEventListener("touchmove",this.touchHandler.bind(this),!0),self.addEventListener("touchend",this.touchHandler.bind(this),!0),self.addEventListener("touchcancel",this.touchHandler.bind(this),!0),this.element.addEventListener("mousedown",this.onmousedown.bind(this),!0),self.addEventListener("mousemove",this.onmousemove.bind(this),!0),self.addEventListener("mouseup",this.onmouseup.bind(this),!0),self.addEventListener("keyup",this.onsensitivitymodifier.bind(this),!0),self.addEventListener("keydown",this.onsensitivitymodifier.bind(this),!0),this.setValue(this.value)}},{key:"parseOptions",value:function(a){this.options=a||{type:"gain",display:"notch",min:0,max:100,step:1,sensitivityMultiplier:1,alwaysMultiply:!0,borderColour:"black",borderWidth:8,indicatorBackgroundColour:"#545454",indicatorColour:"white",indicatorWidth:15,valueBackgroundColour:"black",valueColour:"white",valueFontSize:"1em",inputId:null,zeroModifiers:!1,enableClipboard:!1},this.value=null==this.userOptions?50:this.userOptions.value||50,a&&(this.options.type=a.type||"gain",this.options.display=a.display||"notch",this.options.min=null==a.min?0:a.min,this.options.max=null==a.max?100:a.max,this.options.step=null==a.step?1:a.step,this.options.sensitivityMultiplier=null==a.sensitivityMultiplier?1:a.sensitivityMultiplier,this.options.alwaysMultiply=null==a.alwaysMultiply?!0:a.alwaysMultiply,this.value=null==a.value?50:this.roundToStep(a.value),this.options.borderColour=a.borderColour||"black",this.options.borderWidth=null==a.borderWidth?8:a.borderWidth,this.options.indicatorBackgroundColour=a.indicatorBackgroundColour||"#545454",this.options.indicatorColour=a.indicatorColour||"white",this.options.indicatorWidth=null==a.indicatorWidth?15:a.indicatorWidth,this.options.valueBackgroundColour=a.valueBackgroundColour||"black",this.options.valueBackgroundRadius=null==a.valueBackgroundRadius?87:a.valueBackgroundRadius,this.options.valueColour=a.valueColour||"white",this.options.valueFontSize=a.valueFontSize||"1em",this.options.inputId=a.inputId,this.options.zeroModifiers=null==a.zeroModifiers?!1:a.zeroModifiers,this.options.enableClipboard=null==a.enableClipboard?!1:a.enableClipboard)}},{key:"slide",value:function(a){this.slideValue=a<this.options.min?this.options.min:a>this.options.max?this.options.max:a,this.valueText.textContent=this.slideValue,this.drawIndicator(this.slideValue),this.element.dispatchEvent(new CustomEvent("changed",{detail:this.slideValue}))}},{key:"commitSlide",value:function(a){this.value=this.slideValue,this.inputField&&this.inputField.setAttributeNode(this.attribute("value",this.slideValue))}},{key:"setValue",value:function(a){isNaN(a)||(a=this.roundToStep(a),this.slide(a),this.commitSlide())}},{key:"drawIndicator",value:function(a){"notch"==this.options.display?this.notch(a):"gain"==this.options.type?this.gainFill(a):this.balanceFill(a)}},{key:"notch",value:function(a){var b="M115,115 ",c=this.translate(a),d=115-this.options.borderWidth,e=115+d*Math.sin(c*Math.PI/180),f=115-d*Math.cos(c*Math.PI/180);b+="L"+e+","+f,this.indicator.setAttributeNode(this.attribute("d",b)),this.indicator.setAttributeNode(this.attribute("stroke-width",8))}},{key:"gainFill",value:function(a){var b=this.translate(a),c=115-this.options.borderWidth,d=115+c*Math.sin(225*Math.PI/180),e=115-c*Math.cos(225*Math.PI/180),f=115+c*Math.sin(b*Math.PI/180),g=115-c*Math.cos(b*Math.PI/180),h="M115,115 L"+d+","+e+" ";b>180?h+="A "+c+","+c+" 1 0 1 "+f+","+g+" z":(h+="A "+c+","+c+" 1 0 1 115,"+this.options.borderWidth+" ",h+="L 115,"+this.options.borderWidth+" A "+c+","+c+" 1 0 1 "+f+","+g+" z"),this.indicator.setAttributeNode(this.attribute("d",h)),this.indicator.setAttributeNode(this.attribute("stroke-width",225==b?3:0))}},{key:"balanceFill",value:function(a){var b=this.translate(a),c=115-this.options.borderWidth,d=115+c*Math.sin(b*Math.PI/180),e=115-c*Math.cos(b*Math.PI/180),f="M115,115 L115,"+this.options.borderWidth+" A "+c+","+c+" 1 0 1 "+d+","+e+" z";b>180?f="M115,115 L"+d+","+e+" A "+c+","+c+" 1 0 1 115,"+this.options.borderWidth+" z":0==b&&(f="M115,115 L"+d+","+e+" A "+c+","+c+" 1 0 1 115,"+this.options.borderWidth+" z"),this.indicator.setAttributeNode(this.attribute("d",f)),this.indicator.setAttributeNode(this.attribute("stroke-width",0==b?3:0))}},{key:"translate",value:function(a){var b=270*(a-this.options.min)/(this.options.max-this.options.min)+-135;return 0>b&&(b=360+b),b}},{key:"round",value:function(a,b){var c=this.decimalPlaces(this.options.step);return this.roundPlaces(a,c)}},{key:"roundPlaces",value:function(a,b){var c=Math.pow(10,b);return Math.round(a*c)/c}},{key:"roundToStep",value:function(a){var b=a-this.options.min,c=Math.round(b/this.options.step);return this.options.min+this.options.step*c}},{key:"decimalPlaces",value:function(a){for(var b=Math.abs(a),c=b,d=1;!this.isInt(c)&&isFinite(c);)c=b*Math.pow(10,d++);return d-1}},{key:"isInt",value:function(a){return"number"==typeof a&&parseFloat(a)==parseInt(a,10)&&!isNaN(a)}},{key:"touchHandler",value:function(a){if("touchstart"==a.type?(this.touchCount+=a.changedTouches.length,this.active&&(this.commitSlide(),this.startY=this.clientY)):"touchend"==a.type&&(this.touchCount-=a.changedTouches.length,this.touchCount<0&&(this.touchCount=0),this.active&&(this.commitSlide(),this.startY=this.clientY)),a.target.getAttribute("class")&&-1!=a.target.getAttribute("class").indexOf("tk-audial")){var b=a.changedTouches,c=b[0],d="";switch(a.type){case"touchstart":d="mousedown";break;case"touchmove":d="mousemove";break;case"touchend":d="mouseup";break;default:return}var e=document.createEvent("MouseEvent");e.initMouseEvent(d,!0,!0,window,1,c.screenX,c.screenY,c.clientX,c.clientY,!1,!1,!1,!1,0,null),c.target.dispatchEvent(e),a.preventDefault()}}},{key:"getValue",value:function(a){return a?void this.setValue(a):this.value}},{key:"create",value:function(a,b,c){var d="http://www.w3.org/2000/svg",e="input"==a||"button"==a?document.createElement(a):document.createElementNS(d,a);return e.setAttributeNode(this.attribute("class",b)),"input"==a&&(e.setAttributeNode(this.attribute("id",c)),e.setAttributeNode(this.attribute("name",c)),e.setAttributeNode(this.attribute("type","hidden"))),e}},{key:"attribute",value:function(a,b){var c=document.createAttribute(a);return c.value=b,c}},{key:"hide",value:function(){this.element.style.display="none"}},{key:"selectable",value:function(a){var b=document.querySelector("*");a===!0?b.classList.remove("unselectable"):this.valueText.classList.contains("unselectable")||b.classList.add("unselectable")}},{key:"onmousedown",value:function(a){a.touches&&(a=a.touches[0]),this.startY=a.clientY,this.selectable(!1),this.active=!0}},{key:"onmousemove",value:function(a){if(this.startY){this.clientY=a.clientY,a.preventDefault(),a.touches&&(a=a.touches[0]);var b=(a.clientY-this.startY)*(a.altKey?2:1)*(a.shiftKey?3:1);this.touchCount>1&&(b=(a.clientY-this.startY)*this.touchCount+1),(a.altKey||a.shiftKey||this.touchCount>1||this.options.alwaysMultiply)&&1!=this.options.sensitivityMultiplier&&(b*=this.options.sensitivityMultiplier);var c=this.value+b*this.options.step*-1,d=this.round(c);return void this.slide(d)}}},{key:"onmouseup",value:function(a){if(this.active&&(this.commitSlide(),this.startY=null,this.selectable(!0),this.active=!1,this.options.zeroModifiers&&(this.touchCount=0),this.options.enableClipboard&&this.clipboarder)){this.clipboarder.setAttributeNode(this.attribute("data-clipboard-text",this.getValue()));var b=new Clipboard(this.clipboarder);this.clipboarder.click(),b.destroy()}}},{key:"onsensitivitymodifier",value:function(a){!this.active||16!=a.keyCode&&18!=a.keyCode||(this.commitSlide(),this.startY=this.clientY)}}]),a}();